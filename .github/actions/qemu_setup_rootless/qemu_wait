#!/bin/bash
# Usage: qemu_wait <timeout_seconds>

[ $# -ne 1 ] && exit 1
[ -z "$QEMU_PID" ] && exit 1

TIMEOUT=$1
COUNTER=0

while [ $COUNTER -lt $TIMEOUT ]; do
    [ ! -d "/proc/$QEMU_PID" ] && exit 0
    [ -f "/proc/$QEMU_PID/cmdline" ] && ! grep -q "qemu" "/proc/$QEMU_PID/cmdline" 2>/dev/null && exit 0
    [ ! -f "/proc/$QEMU_PID/cmdline" ] && exit 0

    COUNTER=$((COUNTER + 1))
    sleep 1
done

exit 1
